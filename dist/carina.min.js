!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.carina=t():e.carina=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}r(n(1)),r(n(4)),r(n(2))},function(e,t,n){"use strict";var r=n(2),i=function(){function e(){this.socket=new r.ConstellationSocket,this.waiting={}}return Object.defineProperty(e,"WebSocket",{get:function(){return r.ConstellationSocket.WebSocket},set:function(e){r.ConstellationSocket.WebSocket=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Promise",{get:function(){return r.ConstellationSocket.Promise},set:function(e){r.ConstellationSocket.Promise=e},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){var n=this;return this.socket.on("event:live",function(n){n.channel===e&&t(n.payload)}),this.waitFor("subscription:"+e,function(){return n.socket.execute("livesubscribe",{events:[e]})})["catch"](function(t){throw n.stopWaiting("subscription:"+e),t})},e.prototype.unsubscribe=function(e){return this.stopWaiting("subscription:"+e),this.socket.execute("liveunsubscribe",{events:[e]})},e.prototype.waitFor=function(e,t){return this.waiting[e]?this.waiting[e]:this.waiting[e]=t()},e.prototype.stopWaiting=function(e){delete this.waiting[e]},e}();t.Carina=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=n(3),s=n(4),o=function(e){function t(){var n=this;e.call(this),this.ready=!1,this.messageId=0,this.queue=[],this.socket=new t.WebSocket(t.CONSTELLATION_URL),this.rebroadcastEvent("open"),this.rebroadcastEvent("close"),this.rebroadcastEvent("message"),this.rebroadcastEvent("error"),this.on("message",function(e){return n.extractMessage(e)}),this.once("event:hello",function(){n.ready=!0,n.queue.forEach(function(e){return n.send(e)}),n.queue=[]})}return r(t,e),t.prototype.execute=function(e,n,r){var i=this;return void 0===n&&(n={}),void 0===r&&(r=this.nextId()),this.sendJson({type:"method",method:e,params:n,id:r}),new t.Promise(function(o,c){var u,a=setTimeout(function(){i.removeListener("reply:"+r,u),c(new s.TimeoutError("Timeout waiting for response to "+e+": "+JSON.stringify(n)))},t.REPLY_TIMEOUT);i.once("reply:"+r,u=function(e,t){clearTimeout(a),e?c(e):o(t)})})},t.prototype.sendJson=function(e){this.send(JSON.stringify(e))},t.prototype.send=function(e){return this.ready?(this.emit("send",e),void this.socket.send(e)):void this.queue.push(e)},t.prototype.nextId=function(){return++this.messageId},t.prototype.extractMessage=function(e){var t;try{t=JSON.parse(e)}catch(n){throw new s.MessageParseError("Message returned was not valid JSON")}switch(t.type){case"event":this.emit("event:"+t.event,t.data);break;case"reply":var n=t.error?s.ConstellationError.from(t.error):null;this.emit("reply:"+t.id,n,t.result)}},t.prototype.rebroadcastEvent=function(e){var t=this;this.socket.addEventListener(e,function(n){switch(n.type){case"message":t.emit(e,n.data);break;default:t.emit(e,n)}})},t.WebSocket="undefined"==typeof WebSocket?null:WebSocket,t.Promise="undefined"==typeof Promise?null:Promise,t.CONSTELLATION_URL="wss://constellation.beam.pro",t.REPLY_TIMEOUT=1e4,t}(i.EventEmitter);t.ConstellationSocket=o},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,c,u,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:c=Array.prototype.slice.call(arguments,1),n.apply(this,c)}else if(s(n))for(c=Array.prototype.slice.call(arguments,1),a=n.slice(),i=a.length,u=0;u<i;u++)a[u].apply(this,c);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,o,c;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(c=o;c-- >0;)if(n[c]===t||n[c].listener&&n[c].listener===t){i=c;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){"use strict";var n=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=function(e){function t(t){e.call(this,t),this.message=t}return n(t,e),t}(Error);t.BaseError=r;var i=function(e){function t(){e.apply(this,arguments)}return n(t,e),t}(r);t.TimeoutError=i;var s=function(e){function t(){e.apply(this,arguments)}return n(t,e),t}(r);t.MessageParseError=s;var o;!function(e){function t(e){var t=e.code,n=e.message;return s[t]?new s[t](n):new i(t,n)}var i=function(e){function t(t,n){e.call(this,n),this.code=t}return n(t,e),t}(r);e.Base=i;var s={};e.from=t;var o=function(e){function t(t){e.call(this,4e3,t)}return n(t,e),t}(i);e.InvalidPayload=o,s[4e3]=o;var c=function(e){function t(t){e.call(this,4001,t)}return n(t,e),t}(i);e.PayloadDecompression=c,s[4001]=c;var u=function(e){function t(t){e.call(this,4002,t)}return n(t,e),t}(i);e.UnknownPacketType=u,s[4002]=u;var a=function(e){function t(t){e.call(this,4003,t)}return n(t,e),t}(i);e.UnknownMethodName=a,s[4003]=a;var h=function(e){function t(t){e.call(this,4004,t)}return n(t,e),t}(i);e.InvalidMethodArguments=h,s[4004]=h;var l=function(e){function t(t){e.call(this,4005,t)}return n(t,e),t}(i);e.SessionExpired=l,s[4005]=l;var f=function(e){function t(t){e.call(this,4100,t)}return n(t,e),t}(i);e.LiveUnknownEvent=f,s[4100]=f;var v=function(e){function t(t){e.call(this,4101,t)}return n(t,e),t}(i);e.LiveAccessDenied=v,s[4101]=v;var p=function(e){function t(t){e.call(this,4102,t)}return n(t,e),t}(i);e.LiveAlreadySubscribed=p,s[4102]=p;var d=function(e){function t(t){e.call(this,4103,t)}return n(t,e),t}(i);e.LiveNotSubscribed=d,s[4103]=d}(o=t.ConstellationError||(t.ConstellationError={}))}])});
//# sourceMappingURL=carina.min.js.map